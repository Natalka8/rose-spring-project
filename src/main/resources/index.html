<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Ç–∏–ª–∏—Ç—ã - Rose Application</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            padding: 40px;
            width: 100%;
            max-width: 900px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .utils-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .card p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .btn {
            display: inline-block;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .status-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .status-header h2 {
            color: #333;
            font-size: 1.5rem;
        }

        .status-indicator {
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-up {
            background: #d4edda;
            color: #155724;
        }

        .status-down {
            background: #f8d7da;
            color: #721c24;
        }

        .status-content {
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .status-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .status-item h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-item p {
            color: #666;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .status-up .status-item p {
            color: #28a745;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .json-key {
            color: #d73a49;
        }

        .json-string {
            color: #032f62;
        }

        .json-number {
            color: #005cc5;
        }

        .json-boolean {
            color: #6f42c1;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .refresh-btn {
            background: #17a2b8;
            margin-left: 10px;
        }

        .refresh-btn:hover {
            background: #138496;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .utils-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üöÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É—Ç–∏–ª–∏—Ç—ã</h1>
        <p>Rose Application - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã</p>
    </div>

    <div class="utils-grid">
        <!-- Health Check Card -->
        <div class="card">
            <div class="card-icon">ü©∫</div>
            <h3>Health Check</h3>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã, –ë–î –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
            <a href="/actuator/health" class="btn" target="_blank">
                –û—Ç–∫—Ä—ã—Ç—å Health Check
            </a>
        </div>

        <!-- System Info Card -->
        <div class="card">
            <div class="card-icon">üìä</div>
            <h3>System Info</h3>
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –≤–µ—Ä—Å–∏–∏, —Å–±–æ—Ä–∫–µ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–∏</p>
            <a href="/actuator/info" class="btn btn-secondary" target="_blank">
                –û—Ç–∫—Ä—ã—Ç—å System Info
            </a>
        </div>

        <!-- Database Info Card -->
        <div class="card">
            <div class="card-icon">üóÉÔ∏è</div>
            <h3>Database Info</h3>
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ MySQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
            <a href="/db/info" class="btn btn-success" id="dbLink">
                –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–î
            </a>
            <div style="margin-top: 15px;">
                <small id="dbStatus">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –ë–î...</small>
            </div>
        </div>

        <!-- Additional Monitoring Cards -->
        <div class="card">
            <div class="card-icon">üìà</div>
            <h3>Metrics</h3>
            <p>–ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
            <a href="/actuator/metrics" class="btn" target="_blank">
                –û—Ç–∫—Ä—ã—Ç—å Metrics
            </a>
        </div>

        <div class="card">
            <div class="card-icon">üîß</div>
            <h3>Environment</h3>
            <p>–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
            <a href="/actuator/env" class="btn" target="_blank">
                –û—Ç–∫—Ä—ã—Ç—å Environment
            </a>
        </div>

        <div class="card">
            <div class="card-icon">üó∫Ô∏è</div>
            <h3>URL Mappings</h3>
            <p>–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
            <a href="/actuator/mappings" class="btn" target="_blank">
                –û—Ç–∫—Ä—ã—Ç—å Mappings
            </a>
        </div>
    </div>

    <!-- Status Panel -->
    <div class="status-panel">
        <div class="status-header">
            <h2>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h2>
            <div>
                <span class="status-indicator status-up" id="globalStatus">UP</span>
                <button class="btn refresh-btn" onclick="loadHealthStatus()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
        </div>

        <div class="status-details" id="statusDetails">
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è JavaScript -->
        </div>

        <div class="status-content">
            <h3 style="margin-bottom: 15px; color: #333;">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</h3>
            <pre id="healthStatus">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã...</pre>
        </div>
    </div>

    <div class="footer">
        <p>Rose Application Monitoring Dashboard | –í–µ—Ä—Å–∏—è 1.0.0</p>
        <p style="margin-top: 5px; font-size: 0.8rem; color: #888;">
            –í—Å–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ
        </p>
    </div>
</div>

<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ JSON
    function syntaxHighlight(json) {
        if (!json) return '';

        json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
            function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ health check
    async function loadHealthStatus() {
        try {
            const response = await fetch('/actuator/health');
            const data = await response.json();

            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å
            const globalStatus = document.getElementById('globalStatus');
            globalStatus.textContent = data.status.toUpperCase();
            globalStatus.className = `status-indicator status-${data.status.toLowerCase()}`;

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ—Ç–∞–ª–∏ —Å—Ç–∞—Ç—É—Å–∞
            const statusDetails = document.getElementById('statusDetails');
            if (data.components) {
                let detailsHTML = '';

                for (const [key, component] of Object.entries(data.components)) {
                    if (component.status) {
                        detailsHTML += `
                                <div class="status-item">
                                    <h4>${key}</h4>
                                    <p class="status-${component.status.toLowerCase()}">
                                        ${component.status.toUpperCase()}
                                    </p>
                                </div>
                            `;
                    }
                }
                statusDetails.innerHTML = detailsHTML;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–Ω—ã–π JSON —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
            const healthStatus = document.getElementById('healthStatus');
            healthStatus.innerHTML = syntaxHighlight(JSON.stringify(data, null, 2));

        } catch (error) {
            console.error('Error loading health status:', error);
            document.getElementById('healthStatus').textContent =
                '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö: ' + error.message;
            document.getElementById('globalStatus').textContent = 'ERROR';
            document.getElementById('globalStatus').className = 'status-indicator status-down';
        }
    }

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É
    async function detectDatabaseType() {
        try {
            const response = await fetch('/actuator/health');
            const data = await response.json();

            const dbLink = document.getElementById('dbLink');
            const dbStatus = document.getElementById('dbStatus');

            if (data.components && data.components.database) {
                const dbType = data.components.database.details?.database || 'Unknown';
                const dbMessage = data.components.database.details?.message || '';

                if (dbType === 'MySQL') {
                    dbLink.href = '/actuator/health';
                    dbLink.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å MySQL';
                    dbStatus.textContent = `–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ${dbType}`;
                    dbStatus.style.color = '#28a745';
                } else if (dbType === 'H2') {
                    dbLink.href = '/h2-console';
                    dbLink.innerHTML = '–û—Ç–∫—Ä—ã—Ç—å H2 Console';
                    dbStatus.textContent = `–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ${dbType} (DEV)`;
                    dbStatus.style.color = '#17a2b8';
                } else {
                    dbLink.href = '#';
                    dbLink.innerHTML = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ë–î';
                    dbStatus.textContent = `–¢–∏–ø –ë–î: ${dbType}`;
                }
            }
        } catch (error) {
            console.error('Error detecting database:', error);
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        loadHealthStatus();
        detectDatabaseType();

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadHealthStatus, 30000);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å—Å—ã–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
    document.addEventListener('click', function(e) {
        if (e.target.tagName === 'A' && e.target.getAttribute('href') === '#') {
            e.preventDefault();
            alert('–î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
        }
    });
</script>
</body>
</html>